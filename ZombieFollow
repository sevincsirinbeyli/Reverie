using UnityEngine;
using UnityEngine.AI;

public class ZombieFollow : MonoBehaviour
{
    public Transform target;      // Player
    public float moveSpeed = 2f;
    public float stopDistance = 1.5f;
    public float attackDistance = 1.2f; // attack to the player distance

    private Animator animator;
    private NavMeshAgent agent;
    private bool isDead = false;

    void Start()
    {
        animator = GetComponent<Animator>();
        agent = GetComponent<NavMeshAgent>();

        if(animator != null)
            animator.Play("X Bot@Walking", 0, Random.Range(0f, 1f)); // Eski mantÄ±k, random frame

        // Player reference
        if (target == null)
        {
            GameObject playerObj = GameObject.FindGameObjectWithTag("Player");
            if (playerObj != null)
                target = playerObj.transform;
        }

        // NavMeshAgent settings
        if(agent != null)
        {
            agent.speed = moveSpeed;
            agent.stoppingDistance = stopDistance;
            agent.radius = 0.5f;
            agent.avoidancePriority = Random.Range(20, 60);
        }
    }

    void Update()
    {
        if(target == null || agent == null || isDead) return;

        float distance = Vector3.Distance(transform.position, target.position);

        // animation control
        if(animator != null)
        {
            if(distance <= attackDistance)
                animator.Play("X Bot@Zombie Attack"); // Attack
            else if(!isDead)
                animator.Play("X Bot@Walking", 0, 0f); // Walking
        }

        // Player 
        if(distance > stopDistance && agent.isOnNavMesh)
            agent.SetDestination(target.position);
        else
            agent.ResetPath();
    }

    // killing the zombie
    public void Die()
    {
        if(isDead) return;

        isDead = true;

        if(agent != null)
            agent.isStopped = true;

        if(animator != null)
            animator.Play("X Bot@Zombie Dying"); // Dying 

        Destroy(gameObject, 3f); // 3 minutes after destroy
    }
}
